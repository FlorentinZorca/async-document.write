(function(){var h=0,m=0,b=[],c,n=!1,d=function(a){n&&console.log("Calls:"+h+", Queue:"+b.length+", "+a)},p=function(a,d){setTimeout(function(){a()},d?d:100)},k=function(a){b.push(a);c=a},q=function(a){c&&(c.content+=a,d(" <- Appended to queue for "+c.hookNode.id+": "+a))},s=function(a,c){var f=!1,i=function(a,d){var c=document.createElement("script");c.type="text/javascript";c.text=d;a.appendChild(c);return c},b=function(a,b){f=!0;d("Asynch script: "+b);$.ajax({url:b,dataType:"script",async:!0,timeout:2E3,
complete:function(a,g){d(g+": loaded "+b);c&&c()}})},e=function(a,c){var b=document.createElement("span"),g,f,e,i;b.innerHTML="&nbsp;"+c;b.id=a.id+"-inj";for(f=b.getElementsByTagName("noscript");0<f.length;)i=f[0],i.parentNode.removeChild(i),d("Sick: noscript tag created via document.write.");f=b.getElementsByTagName("script");for(i=0;0<f.length;){g=e=f[0];var o=a.id+"-s-"+i++,h=g.parentNode,j=void 0,j=document.createElement("span");j.id=o?o:"hook-"+m++;h.replaceChild(j,g)||(h.removeChild(g),h.appendChild(j));
g=j;e.src?(k({hookNode:g,contentType:"script-extern",content:e.src}),d(" <- Queued external script to "+g.id+": "+e.src)):(k({hookNode:g,contentType:"script-inline",content:e.text}),d(" <- Queued inline script to "+g.id+": "+e.text))}b.innerHTML&&(b.removeChild(b.childNodes[0]),a.appendChild(b),d(" -> Injected static html to "+a.id+": id = "+b.id+", content = "+b.innerHTML))};a?a.hookNode&&a.content?"html"===a.contentType?e(a.hookNode,a.content):(k({hookNode:a.hookNode,contentType:"html",content:"<\!-- "+
a.hookNode.id+" script --\>"}),d(" <- Queued start tag for script in "+a.hookNode.id),document.write=function(){var c;arguments.length&&(h++,c=Array.prototype.slice.call(arguments).join(""),q(c),d(" <- Appended to context implant "+a.hookNode.id+": "+c))},"script-inline"===a.contentType?i(a.hookNode,a.content):b(a.hookNode,a.content)):d("Could not find hook node "+a.hookNode?a.hookNode.id:"NULL"):d("No implant?");f&&d("Asynch scripts spawned.");!f&&c&&(d("Calling back after pure inline content."),
c())},r=function(){var a;0<b.length?(d("Dequeuing"),c=a=b.shift(),s(a,function(){0<b.length?(d(a.hookNode.id+" done. Dequeue next one."),p(r)):(d(a.hookNode.id+" done. It was the last queue item."),c=null)})):d("Dequeue from empty queue.")},e={write:function(){var a,b,f;if(arguments.length){h++;f=Array.prototype.slice.call(arguments).join("");a=document.getElementsByTagName("script");0<a.length&&(b=a[a.length-1]);a=b.parentNode;var e=c?c.scriptNode?c.scriptNode:c.hookNode:null;if(!b||e===b)q(f);else{var e=
"hook-"+m++,l=document.createElement("span");l.id=e;a.appendChild(l);k({hookNode:l,scriptNode:b,contentType:"html",content:f});d(" <- Queued write to "+e+": "+f)}}},applyWrite:function(){p(r)},enableLogging:function(){n=!0}};if(window.console){if(!window.console.log)console.log=function(){}}else window.console={log:function(){}};document.write=e.write;document.applyWrite=e.applyWrite;window.asyncWrite=e;"function"===typeof define&&define.amd&&define("async-document.write",function(){return e});return e})(window);
