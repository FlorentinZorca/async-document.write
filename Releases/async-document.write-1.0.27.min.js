(function(){var h=0,m=0,b=[],c,n=!1,d=function(a){n&&console.log("Calls:"+h+", Queue:"+b.length+", "+a)},p=function(a,d){setTimeout(function(){a()},d?d:100)},k=function(a){b.push(a);c=a},q=function(a){c&&(c.content+=a,d(" <- Appended to queue for "+c.hookNode.id+": "+a))},s=function(a,c){var i=!1,g=function(a,d){var c=document.createElement("script");c.type="text/javascript";c.text=d;a.appendChild(c);return c},b=function(a,b){i=!0;d("Asynch script: "+b);$.ajax({url:b,dataType:"script",async:!0,timeout:2E3,
complete:function(a,f){d(f+": loaded "+b);c&&c()}})},e=function(a,c){var b=document.createElement("span"),f,i,e,g;b.innerHTML="&nbsp;"+c;b.id=a.id+"-inj";i=b.getElementsByTagName("script");for(g=0;0<i.length;){f=e=i[0];var o=a.id+"-s-"+g++,h=f.parentNode,j=void 0,j=document.createElement("span");j.id=o?o:"hook-"+m++;h.replaceChild(j,f)||(h.removeChild(f),h.appendChild(j));f=j;e.src?(k({hookNode:f,contentType:"script-extern",content:e.src}),d(" <- Queued external script to "+f.id+": "+e.src)):(k({hookNode:f,
contentType:"script-inline",content:e.text}),d(" <- Queued inline script to "+f.id+": "+e.text))}b.innerHTML&&(b.removeChild(b.childNodes[0]),a.appendChild(b),d(" -> Injected static html to "+a.id+": id = "+b.id+", content = "+b.innerHTML))};a?a.hookNode&&a.content?"html"===a.contentType?e(a.hookNode,a.content):(k({hookNode:a.hookNode,contentType:"html",content:"<\!-- "+a.hookNode.id+" script --\>"}),d(" <- Queued start tag for script in "+a.hookNode.id),document.write=function(){var c;arguments.length&&
(h++,c=Array.prototype.slice.call(arguments).join(""),q(c),d(" <- Appended to context implant "+a.hookNode.id+": "+c))},"script-inline"===a.contentType?g(a.hookNode,a.content):b(a.hookNode,a.content)):d("Could not find hook node "+a.hookNode?a.hookNode.id:"NULL"):d("No implant?");i&&d("Asynch scripts spawned.");!i&&c&&(d("Calling back after pure inline content."),c())},r=function(){var a;0<b.length?(d("Dequeuing"),c=a=b.shift(),s(a,function(){0<b.length?(d(a.hookNode.id+" done. Dequeue next one."),
p(r)):(d(a.hookNode.id+" done. It was the last queue item."),c=null)})):d("Dequeue from empty queue.")},e={write:function(){var a,b,e;if(arguments.length){h++;e=Array.prototype.slice.call(arguments).join("");a=document.getElementsByTagName("script");0<a.length&&(b=a[a.length-1]);a=b.parentNode;var g=c?c.scriptNode?c.scriptNode:c.hookNode:null;if(!b||g===b)q(e);else{var g="hook-"+m++,l=document.createElement("span");l.id=g;a.appendChild(l);k({hookNode:l,scriptNode:b,contentType:"html",content:e});
d(" <- Queued write to "+g+": "+e)}}},applyWrite:function(){p(r)},enableLogging:function(){n=!0}};if(window.console){if(!window.console.log)console.log=function(){}}else window.console={log:function(){}};document.write=e.write;document.applyWrite=e.applyWrite;window.asyncWrite=e;"function"===typeof define&&define.amd&&define("async-document.write",function(){return e});return e})(window);
