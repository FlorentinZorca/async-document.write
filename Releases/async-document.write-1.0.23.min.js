(function(){var o=0,p=0,i=[],d,l,m=!1,c=function(a){m&&console.log&&console.log("Calls:"+o+", Queue:"+i.length+", "+a)},q=function(a,c){setTimeout(function(){a()},c?c:100)},r=function(a,b){var g=d?d.scriptNode?d.scriptNode:d.hookNode:null;if(!a||g===a&&g!==l)d&&(d.content+=b,c(" <- Appended to queue for "+d.hookNode.id+": "+b));else{var g="hook-"+p++,n=a.parentNode,e=document.createElement("span");e.id=g;n.appendChild(e);n={hookNode:e,scriptNode:a,contentType:"html",content:b};i.push(n);d=n;c(" <- Queued write to "+
g+": "+b)}},t=function(a,b){var g=!1,e=function(a,c){var f=document.createElement("script");f.type="text/javascript";f.text=c;a.appendChild(f);return f},l=function(a,d){g=!0;c("Asynch script: "+d);$.ajax({url:d,dataType:"script",async:!0,timeout:2E3,complete:function(a,g){c(g+": loaded "+d);b&&b()}})},m=function(a,g){var f=document.createElement("span"),b,e,j;f.innerHTML="&nbsp;"+g;f.id=a.id+"-inj";for(e=f.getElementsByTagName("script");0<e.length;){b=j=e[0];var h=b.parentNode,k=void 0,k=document.createElement("span");
k.id="hook-"+p++;h.replaceChild(k,b)||(h.removeChild(b),h.appendChild(k));b=k;j.src?(h={hookNode:b,contentType:"script-extern",content:j.src},i.push(h),d=h,c(" <- Queued external script to "+b.id+": "+j.src)):(h={hookNode:b,contentType:"script-inline",content:j.text},i.push(h),d=h,c(" <- Queued inline script to "+b.id+": "+j.text))}f.innerHTML&&(f.removeChild(f.childNodes[0]),a.appendChild(f),c(" -> Injected static html to "+a.id+": id = "+f.id+", content = "+f.innerHTML))};if(a)if(a.hookNode&&a.content)switch(document.write=
function(){var b;arguments.length&&(o++,b=Array.prototype.slice.call(arguments).join(""),r(a.hookNode,b),c(" <- Appended to context implant "+a.hookNode.id+": "+b))},a.contentType){case "script-inline":e(a.hookNode,a.content);break;case "script-extern":l(a.hookNode,a.content);break;case "html":m(a.hookNode,a.content)}else c("Could not find hook node "+a.hookNode?a.hookNode.id:"NULL");else c("No implant?");g&&c("Asynch scripts spawned.");!g&&b&&(c("Calling back after pure inline content."),b())},s=
function(){var a;0<i.length?(c("Dequeuing"),l=a=i.shift(),t(a,function(){0<i.length?(c(a.hookNode.id+" done. Dequeue next one."),q(s)):(c(a.hookNode.id+" done. It was the last queue item."),d=null)})):c("Dequeue from empty queue.")},e={write:function(){var a,b,c;arguments.length&&(o++,c=Array.prototype.slice.call(arguments).join(""),a=document.getElementsByTagName("script"),0<a.length&&(b=a[a.length-1]),r(b,c))},applyWrite:function(){q(s)},enableLogging:function(){m=!0}};document.write=e.write;document.applyWrite=
e.applyWrite;window.asyncWrite=e;"function"===typeof define&&define.amd&&define("async-document.write",function(){return e});return e})(window);
